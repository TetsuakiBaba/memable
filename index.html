<!DOCTYPE html>
<html lang="ja" data-bs-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self';">
    <title>memable</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fffb85">
    <!-- PWA（iOS）対応 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
</head>

<body>
    <nav class="navbar navbar-expand-lg m3-surface">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="icons/icon-192.png" alt="icon" width="24" height="24" class="me-2">
                memable
            </a>

            <button id="grid-toggle" class="btn m3-button-tonal py-1 px-3 me-2 ms-auto" type="button" title="Grid Snap">
                <span class="material-symbols-outlined">grid_4x4</span>
                <span class="btn-text">Grid: OFF</span>
            </button>
            <button id="align-notes" class="btn m3-button-tonal py-1 px-3 me-2" type="button" title="Align Notes">
                <span class="material-symbols-outlined">grid_view</span>
            </button>
            <button id="settings-button" class="btn m3-button-tonal py-1 px-3 me-2" type="button" title="Settings">
                <span class="material-symbols-outlined">settings</span>
            </button>
            <button id="help-button" class="btn m3-button-tonal py-1 px-3 me-2" type="button" title="Help">
                <span class="material-symbols-outlined">help</span>
            </button>
            <button id="clear-all-button" class="btn m3-button-danger py-1 px-3 me-3" type="button" title="Clear All">
                <span class="material-symbols-outlined">delete_sweep</span>
                <span id="number_of_memo"></span>
            </button>
        </div>
    </nav>
    <div id="main-layout" class="d-flex w-100">
        <aside id="sidebar" class="m3-surface">
            <div class="sidebar-header p-3 border-bottom d-flex align-items-center justify-content-between">
                <h6 class="mb-0 sidebar-title">Groups</h6>
                <div class="d-flex gap-1">
                    <button id="add-group-button" class="btn btn-sm m3-button-tonal p-1" title="New Group">
                        <span class="material-symbols-outlined">add</span>
                    </button>
                    <button id="toggle-sidebar-button" class="btn btn-sm m3-button-tonal p-1" title="Toggle Sidebar">
                        <span class="material-symbols-outlined">menu_open</span>
                    </button>
                </div>
            </div>
            <div id="group-list" class="flex-grow-1 overflow-auto py-2">
                <!-- Groups will be rendered here -->
            </div>
        </aside>
        <div id="workspace" class="position-relative flex-grow-1"></div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content m3-surface text-body">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <section class="mb-4">
                        <h6>Appearance</h6>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="themeToggle">
                            <label class="form-check-label" for="themeToggle">Dark Mode</label>
                        </div>
                    </section>
                    <hr>
                    <section class="mb-4">
                        <h6>Shortcuts (Electron Only)</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="shortcut-toggle-switch">
                            <label class="form-check-label" for="shortcut-toggle-switch">Global Shortcuts</label>
                        </div>
                        <ul class="small text-muted ps-3 mb-0">
                            <li>Quick Paste: <code>Cmd/Ctrl + Alt + [1-0/a-z]</code></li>
                        </ul>
                        <p class="small text-muted mt-1" style="font-size: 0.75rem;">
                            (Copies the note content to clipboard and triggers system paste automatically)
                        </p>
                    </section>
                    <hr>
                    <section class="mb-4">
                        <h6>Storage (Electron Only)</h6>
                        <p class="small text-muted mb-2">Sync with external folder (Dropbox, etc.)</p>
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="text" id="storage-path-display" class="form-control form-control-sm" readonly
                                placeholder="IndexedDB (Standard)">
                            <button id="change-storage-button" class="btn btn-sm m3-button-tonal">Change</button>
                        </div>
                        <div id="storage-status" class="alert alert-info py-1 px-2 small d-none">External sync active
                        </div>
                    </section>
                    <hr>
                    <section class="mb-2">
                        <h6>Data Backup</h6>
                        <div class="d-grid gap-2 d-md-block">
                            <button id="export-button" class="btn btn-sm m3-button-primary me-2">
                                <span class="material-symbols-outlined align-middle fs-6">download</span> Export JSON
                            </button>
                            <label for="import-input" class="btn btn-sm m3-button-tonal mb-0">
                                <span class="material-symbols-outlined align-middle fs-6">upload</span> Import JSON
                            </label>
                            <input type="file" id="import-input" class="d-none" accept=".json">
                        </div>
                    </section>
                    <hr>
                    <section class="mb-2">
                        <h6>Initialization</h6>
                        <button id="reset-app-button" class="btn btn-sm m3-button-danger">
                            <span class="material-symbols-outlined align-middle fs-6">restart_alt</span> Reset to
                            Default
                        </button>
                        <p class="small text-muted mt-2 mb-0">Warning: This will clear all notes and settings.</p>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Name Modal -->
    <div class="modal fade" id="groupModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content m3-surface text-body">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title" id="groupModalTitle">Group Name</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="group-name-input" class="form-control m3-input w-100"
                        placeholder="Enter name...">
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-sm m3-button-tonal" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="group-modal-save" class="btn btn-sm m3-button-primary">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content m3-surface text-body">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Manual / Help</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body overflow-auto" style="max-height: 70vh;">
                    <div class="mb-3 d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="mb-0">memable</h6>
                            <small id="appVersion" class="text-muted"></small>
                        </div>
                        <a href="https://github.com/TetsuakiBaba/memable" class="text-secondary" target="_blank"
                            rel="noopener" title="GitHub">
                            <span class="material-symbols-outlined fs-4">terminal</span>
                        </a>
                    </div>
                    <h6>Basic Operations</h6>
                    <ul>
                        <li><strong>Create Note</strong>: Double-click on background</li>
                        <li><strong>Move</strong>: Drag node header</li>
                        <li><strong>Add Images</strong>: Drag & Drop or Paste (Cmd+V)</li>
                        <li><strong>Undo Delete</strong>: Ctrl/Cmd + Z (restores the last deleted note)</li>
                    </ul>
                    <hr>
                    <h6>Keyboard Shortcuts (Map to IDs)</h6>
                    <p class="small text-muted">Web Browser & Desktop App (Internal):</p>
                    <ul>
                        <li><strong>[1-0], [a-z]</strong>: Copy note content to clipboard</li>
                    </ul>
                    <p class="small text-muted">Desktop App Only (Global):</p>
                    <ul>
                        <li><strong>Cmd/Ctrl + Opt/Alt + [1-0/a-z]</strong>: Quick Paste (Copy & automatically paste to
                            active cursor)</li>
                    </ul>
                    <hr>
                    <h6>Group Management</h6>
                    <ul>
                        <li><strong>Rename</strong>: Double-click group name in sidebar</li>
                        <li><strong>Toggle</strong>: Click menu icon in sidebar header</li>
                    </ul>
                    <hr>
                    <h6>Sync Settings</h6>
                    <ul>
                        <li>(Desktop App Only) Set an external folder in Settings for real-time synchronization between
                            devices.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Image enlarge modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content bg-transparent border-0">
                <img id="modalImage" src="" class="img-fluid" alt="Enlarged image">
            </div>
        </div>
    </div>
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>